{"type":"article","id":2326,"title":"以习近平思想指导ArchLinux安装（一）","uid":6382,"topics":[318,559,2413,2436],"contents":"【前言】<br>\n习主席的思想<b>包</b>揽万物，适用于疯狂宇宙一切事物，而ArchLinux作为一个相对比较难以安装的Linux发行版，其安装则更需要“山再高，往上攀”、“天行健，君子以自强不息”的习近平思想的指引，为了方便那些文化程度只有小学水平的用户，这里将尽可能使用通俗易懂的庆丰话书写，从而让每一个萨格尔王都能用上ArchLinux，如果有不当之处，请各位颐使气指的教师爷多多指教包涵。<br>\n<i><u>警告：安装任何操作系统都是对硬盘数据的一种高危行为，请务必在行动前多次阅读本教程并知晓可能带来的后果，如果你只是想练<b>习</b>，请使用一个仅装有空硬盘的机器进行安装，或者使用虚拟机，笔者不为操作不当造成的数据丢失负责。</u></i><br>\n<br>\n【安装前的准备】<br>\n<br>\nArchlinux的硬件需求不高，只需要一台超过 530 MiB 内存的X86 -64 机器。基本安装将占用小于 2 GiB 的存储空间，如果需要多重引导（双系统），请在教程之前提前使用磁盘管理工具压缩磁盘以获得无任何分区的“空白区域”（<a href=\"https://support.microsoft.com/zh-cn/help/944248\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">Windows下的操作</a>，<a href=\"https://support.apple.com/zh-cn/guide/disk-utility/dskutl14027/mac\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">MacOS下的操作</a>，其他操作系统下的操作请自行Google），由于要安装图形界面，建议预留16GiB及以上空间。<br>\n<b>习主席教导我们：“互联网让世界变成了“鸡犬之声相闻”的地球村，相隔万里的人们不再‘老死不相往来’”，由于安装过程中需要从远程存储库获取软件包，机器将需要一个有效的互联网连接，因此请保证你的计算机连接上了互联网。</b><br>\n首先要从官网或镜像站里找到安装文件和它的Gnu PG签名，然后进行下载以及校验，在安装前请一定要校验Gnu PG签名，在镜像站里下载安装文件更要注意它的Gnu PG签名，小心你已经下载好的文件中途被动了手脚，到时候一打开啊满电脑里是病毒就坏了，打开命令指示符，转到下载目录，然后输入以下的金科玉律的命令（如果是Windows的话得先要安装Gnu PG校验工具再输入）：<br>\n<blockquote>gpg --keyserver-options auto-key-retrieve --verify archlinux-<i>version</i>-x86_64.iso.sig</blockquote><br>\nGnuPG的具体用法可以参考<a href=\"https://wiki.archlinux.org/index.php/GnuPG_(简体中文)\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">这个页面</a>，关于GnuPG的具体用法及说明这里不再赘述。<br>\n<br>\n【启动到 live 环境】<br>\n<br>\n拿到镜像并酵验之后，我们就可以准备把Archlinux突进颐使气指的计算机了，首先得使用大家青年时代就用过的像是dd命令、Ultra ISO、Rurfs、etcher等光盘映像写入软件制作启动媒介（注意：制作启动媒介将清空媒介上的所有内容），我这里建议使用一个没有任何资料的空U盘制作一个U盘启动媒介，制作好了之后就可以准备启动了<br>\n首先彻底关闭你的计算机，然后按下厂商规定的BIOS/UEFI热键（不同厂商不同，详见计算机/主板说明书），转到启动项设置，首先关闭安全启动，然后在将USB相关的启动项设在第一位并保存（操作方式取决于计算机/主板厂商，敬请参考说明书），直到重启后可以看到Archlinux的字样及Logo即可，当 Arch 菜单出现时，选择 <i>Boot Arch Linux</i> 并按 Enter 键进入安装环境，建议首先使用命令检查一下设备是否支持uefi启动，命令如下：<br>\n<blockquote># ls /sys/firmware/efi/efivars</blockquote><br>\n如果支持（只要不输出“目录不存在”，即为支持，如果不懂输出的意思，建议使用Google翻译），请务必按照uefi安装方式安装（即标注有“仅efi”等类似字样的命令），否则有无法启动的风险。<br>\n<br>\n【连接网络】<br>\n<br>\n安装过程中建议使用有线网络，即使只能使用无线网络，建议使用智能手机连接热点再使用“USB网络分享”功能来变相连接无线网络，如果没有智能手机，Archlinux直接连接无线网络的方法参见<a href=\"https://wiki.archlinux.org/index.php/Wireless_network_configuration\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">这个页面</a>，使用ip link检查网络适配器可用性，然后用ping命令检测网络是否可用，同时使用timedatectl set-ntp true命令来与时间进行同步，如果时间被长者偷走导致不同步，那么有可能会无法访问一些网站。<br>\n<br>\n【硬盘分区】<br>\n<br>\n使用cfdisk进入分区工具进行分区，如果你的硬盘为空，那么第一次会提示你选择分区表类型，使用GPT（仅efi可用）或DOS（MBR）即可，对于一些较新的电脑，这里推荐GPT（因为MBR分区表不支持单块容量在2T以上的硬盘）。分区操作因安装种类、硬盘内数据不同而不同，如果你使用一块全新的硬盘（空盘）进行安装（双系统则需要用硬盘当中剩余的可用空间分区，建议在安装前提前压缩卷），那么只需要保留分为2～3个分区，一个主分区（推荐大小大于5GB，越大越好，最好把除过下述两个分区的大小全部用上）和一个交换分区（大于512MB，小于机器物理内存容量），如果使用efi安装，那么还需要一个256mb~512mb不等的efi分区（如果你的硬盘里已经有了一个efi分区，那么无需再次创建，如果cfdisk界面里有一个vfat格式且大小在256MB～512MB之间的的分区则为efi分区），操作方式：选择[new]新建分区（分区大小单位为MB，1GB=1024MB）、[delete]删除分区（慎用，删除分区会丢失所有分区内的文件），[resize]压缩分区，分区完成后选择[write]将分区表保存即可（提示要求输入时请输入yes即可），<b>以上操作一定要谨慎，别看今天分区时闹得欢，小心啊数据丢失拉清单</b>。<br>\n<br>\n【格式化并挂载分区】<br>\n<br>\n首先通过lsblk -f确定一下分区的名称（一定记住那几个“FSTYPE”为空的分区所对应的“NAME”，<b>否则一旦格式化错了，帐都是记在那的，这都得应验的（指数据丢失）</b>，而且后面要用到，最好写在清单里，如果有“FSTYPE”对应值为vfat的分区也请写在清单里），然后用mkfs.ext4 将那个容量最大的空分区格式化成ext4格式，再用mkswap 格式化那个容量第二大的空分区为交换分区，最后再用mkfs.vfat格式化efi分区（注意：仅efi安装，如果lsblk -f输出中能看到分区表内已存在“FSTYPE”对应值vfat的分区，则直接挂载即可，无视刚才那个格式化好的空分区）<br>\n然后把这三个分区用mount挂载到对应的挂载点，用mount+dev/分区名称+挂载点 （请将“+”换成半角空格，以下同）的格式命令挂载到对应的挂载点，挂载点如下：<br>\n刚才格式化的容量最大的分区(主分区)： /mnt<br>\n刚才格式化的容量最小的分区或者已存在分区中“FSTYPE”所对应的值为“vfat”的分区（efi分区）： /mnt/boot（仅efi安装）<br>\n之后用swapon+分区名称 的命令启用刚才格式化好容量第二大的分区，格式化和挂载工作结束。<br>\n<br>\n【安装基本环境】<br>\n<br>\n直接输入命令然后坐和放宽即可，等到输出类似于“89.64s user 2.51s system 85% cpu 23.333 total”这类提示在进行下一步操作（以上输出内容是我乱编的，但是真实输出的格式都差不多）<br>\n<blockquote>pacstrap /mnt base linux linux-firmware</blockquote><br>\n然后生成fstab就可以准备进安装好的系统里了<br>\n<blockquote>genfstab -U /mnt &gt;&gt; /mnt/etc/fstab</blockquote><br>\nchroot进入安装好的系统<br>\n<blockquote>arch-chroot /mnt /bin/bash</blockquote><br>\n<br>\n【设置新系统】<br>\n<br>\n首先设置时区，如果你在中国或者其他UTC+8区域（新加坡马来西亚都属于UTC+8）的话就设置成上海<br>\n<blockquote>ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</blockquote><br>\n设置硬件时间标准以UTC为基准（请注意，其他非Unix操作系统如Windows都直接使用硬件时钟为准，加入这条命令后会让Windows时间出现异常（一般是被续走8个小时），如果你使用NT6.2以上内核的操作系统，只需要修改注册表即可，使用cmd命令：reg add \"HKEY_LOCAL_MACHINESystemCurrentControlSetControlTimeZoneInformation\" /v RealTimeIsUniversal /d 1 /t REG_DWORD /f”（以上内容我搜来的，实际上我也不懂这是什么意思））<br>\n<blockquote># hwclock --systohc --utc</blockquote><br>\n准备修改locale.gen，先搞个编辑器，<b>习主席曾经说过：“在人民面前，我们永远是小学生。”</b>，因此这里推荐nano，这个编辑器小学生都会用<br>\n<blockquote>pacman -S nano</blockquote><br>\n然后编辑/etc/locale.gen<br>\n<blockquote>nano -w /etc/locale.gen</blockquote><br>\n打开后把里面自己所需要的地区前方的#去掉，参考：简体中文为“zh_CN”，繁体中文为“zh_TW”，英文为“en_US”，之后按下Ctrl+O保存，如果提示Yes/No，选Yes按Enter即可<br>\n<br>\n生成locale.conf并选择英文为主语言（由于没有其他语言所对应的字体，所以先设置英文）<br>\n<blockquote>locale-gen</blockquote><br>\n待输出结束后再输入<br>\n<blockquote>echo LANG=en_US.UTF-8 &gt; /etc/locale.conf</blockquote><br>\n设置主机名（这里以“Winnie”为例，实际上想起什么名字就能起什么名字）<br>\n<blockquote>echo Winnie &gt; /etc/hostname</blockquote><br>\n用passwd命令设置root密码（注意这个密码你无法看到，很正常，由于日后很少会使用root账户而是直接使用普通账户+sudo命令，因此建议先设置一个简单的写在纸上，等到安装工作全部结束之后再修改为一个高强度的密码或者直接禁用root用户），输入完后再输入一遍，直到输出“passwd: password updated successfully”为止，否则请再使用passwd设置root密码<br>\n<br>\n【安装GRUB】<br>\n<br>\n如果一切顺利，就可以准备安装GRUB了，如果你还记得刚才的那张写有分区名称及大小的小纸条的话，把它拿出来，因为马上就要用到了，如果你把它丢了，那么请用lsblk -f再看一遍，不过这次找“MOUNTPOINT”中“/mnt”所对应的分区名称，尤其是多硬盘用户（比如说我），分区名称往往是由字母+数字构成的，把那位数字去掉，以下所有命令中出现到“sda”的内容，一律用去掉数字的分区名称（硬盘名）来代替。<br>\n安装GRUB<br>\n<blockquote>pacman -S grub os-prober</blockquote><br>\n如果你是UEFI安装，还需要加上这个命令<br>\n<blockquote># pacman -S efibootmgr</blockquote><br>\n然后安装GRUB(非UEFI用户)<br>\n<blockquote>grub-install --target=i386-pc /dev/sda --recheck</blockquote><br>\nUEFI用户请无视上面那条命令，按照这个命令来<br>\n<blockquote>grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=grub --recheck</blockquote><br>\n最后生成grub配置<br>\n<blockquote>grub-mkconfig -o /boot/grub/grub.cfg</blockquote><br>\n在此过程中如果出现任何命令和报错，请参考<a href=\"https://wiki.archlinux.org/index.php/GRUB_(简体中文)\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">ArchWiki中的相关页面</a><br>\n<br>\n【总结】<br>\n<br>\n如果以上过程中都没有问题，那么你可以直接重启了，按下ctrl+d，离开chroot，输入umount -R /mnt<br>\n卸载分区，然后输入reboot敲击回车重启并拔掉U盘，看到开机后显示的grub启动选项，然后按下回车进入arch的命令行界面，我不禁的酵出了声。但是习主席说过：“要从中国国情和实际出发，走适合自己的法治道路”，而只有命令行的操作界面对于大部分萨格尔王而言并不习惯，不符合大部分萨格尔王的实际需求，因此我们将在<a href=\"https://www.mohu.rocks/article/2337\">下一篇文章</a>中继续用习近平思想指导Archlinux图形界面的安装。","date":"2020-06-14","agreeCount":16,"discussionCount":0}