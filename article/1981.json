{"type":"article","id":1981,"title":"[站务]reddit翻车新闻懒人搬运代码","uid":4739,"topics":[432,1390,2164,2165,2524,2807],"contents":"import re<br>\nimport urllib<br>\nimport urllib.request<br>\nfrom bs4 import BeautifulSoup<br>\n<br>\ndef is_valid(link):<br>\n&nbsp; &nbsp; return 'redditstatic' not in link<br>\n<br>\ndef find(url):<br>\n&nbsp; &nbsp; <br>\n&nbsp; &nbsp; page = urllib.request.urlopen(url)<br>\n&nbsp; &nbsp; soup = BeautifulSoup(page,'html.parser')<br>\n&nbsp; &nbsp; title = soup.title.string<br>\n&nbsp; &nbsp; print(title)<br>\n&nbsp; &nbsp; taglist = soup.find_all(['p','img'])<br>\n&nbsp; &nbsp; text_string = ''<br>\n&nbsp; &nbsp; target_str = '[/img]'<br>\n&nbsp; &nbsp; for tr in taglist:<br>\n&nbsp; &nbsp; &nbsp; &nbsp; if tr.text:<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; text_string += tr.text<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; text_string += '\\n'<br>\n&nbsp; &nbsp; &nbsp; &nbsp; else:<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; text_string += ''<br>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; text_string += tr['src']<br>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; text_string += '\\n'<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>\n&nbsp; &nbsp; pos = text_string.rfind(target_str)<br>\n&nbsp; &nbsp; <br>\n&nbsp; &nbsp; text_string = text_string[0:pos + len(target_str)]<br>\n&nbsp; &nbsp; text_string = text_string.split('\\n')<br>\n&nbsp; &nbsp; text_string = filter(is_valid, text_string)<br>\n&nbsp; &nbsp; text_string = '\\n'.join(text_string)<br>\n&nbsp; &nbsp; print(text_string)<br>\n#url = 'http://127.0.0.1/phptest/reddit.html'<br>\n#find(url)","date":"2020-05-10","agreeCount":14,"discussionCount":0}