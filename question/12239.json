{"type":"question","id":12239,"title":"一种文字转图片时，防止OCR审查的方法","uid":8397,"topics":[158,488],"contents":"&nbsp; &nbsp; &nbsp; &nbsp;这个内容我在葱上也发过，但程序并未优化，今天有点时间，将代码由GO换成了PYTHON<br>\n<br>\n&nbsp; &nbsp; &nbsp; &nbsp;具体研究过程什么的在葱有，这里不多说，直接上结论：<br>\n&nbsp; &nbsp; &nbsp; &nbsp;依照目前的OCR引擎发展，加噪点、划线等方法已经无法阻止OCR审查，尤其是腾讯的OCR引擎，上述方法几乎无法对其造成有效干扰<br>\n<br>\n&nbsp; &nbsp; &nbsp; &nbsp;考虑到VX，QQ庞大的用户数，安排人工审核用户一对一聊天几乎不可能，只能通过机器进行关键字识别，此时很可能引入OCR来防止反贼通过文转图传播信息<br>\n<br>\n&nbsp; &nbsp; &nbsp; &nbsp;在实验过各种方案后，终于发现一种不会过于影响人类阅读，又可以成功让目前测试过的所有OCR引擎，全部失效的办法。这种方法简单来说就是加入机器无法判断，但人眼可以轻松分辨的干扰文字，使用中需要做到以下三点：<br>\n&nbsp; &nbsp; &nbsp; &nbsp;1.真实信息采用较少见字体（如各类行书、手写体），可以用醒目的颜色如黑色<br>\n&nbsp; &nbsp; &nbsp; &nbsp;2.伪装用的信息采用宋体、楷体等字体<br>\n&nbsp; &nbsp; &nbsp; &nbsp;3.伪装信息离图片边框的距离，要小于真实信息，以使OCR引擎第一时间看到干扰信息<br>\n<br>\n&nbsp; &nbsp; &nbsp; &nbsp;此方法生成的图片如下，只要将图片稍稍放大（若调高字号，可不必放大），即可轻松识别出真实文本<br>\n<br>\n<a href=\"https://i.imgur.com/sVuAX03.jpg\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/sVuAX03.jpg\" alt=\"https://i.imgur.com/sVuAX03.jpg\" style=\"max-width:100%\"></a><br>\n<br>\n代码如下：<br>\n<br>\nfrom PIL import Image<br>\nfrom PIL import ImageDraw<br>\nfrom PIL import ImageFont<br>\nimport sys<br>\nimport random<br>\nimport time<br>\n<br>\n#从干扰字符串中随机截取一段<br>\ndef subStr(str):<br>\n&nbsp; &nbsp; random.seed(time.time() + random.randint(63256, 49896594))<br>\n&nbsp; &nbsp; r = random.randint(0, len(str))<br>\n&nbsp; &nbsp; while r &gt;= len(str) - 18:<br>\n&nbsp; &nbsp; &nbsp; &nbsp; r = random.randint(1, len(str))<br>\n&nbsp; &nbsp; return str[r:r + 18]<br>\n<br>\n<br>\n# 参数定义<br>\n# 要发送的真实信息<br>\ntrueStr = \"尔来四万八千岁，不与秦塞通人烟。西当太白有鸟道，可以横绝峨眉巅。地崩山摧壮士死，然后天梯石栈相勾连。上有六龙回日之高标，下有冲波逆折之回川。\"<br>\n# 干扰用文本，其中不要有空格，防止露出真实信息<br>\ndisturbStr = \"秦孝公据殽函之固，拥雍州之地，君臣固守以窥周室，有席卷天下，包举宇内，囊括四海之意，并吞八荒之心。当是时也，商君佐之，内立法度，\" \\<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \"务耕织，修守战之具，外连衡而斗诸侯。于是秦人拱手而取西河之外。孝公既没，惠文、武、昭襄蒙故业，因遗策，南取汉中，西举巴、蜀，东割膏腴之地，\" \\<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \"北收要害之郡。诸侯恐惧，会盟而谋弱秦，不爱珍器重宝肥饶之地，以致天下之士，合从缔交，相与为一。当此之时，齐有孟尝，赵有平原，楚有春申，\" \\<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \"魏有信陵。此四君者皆明智而忠信，宽厚而爱人，尊贤而重士，约从离衡，兼韩、魏、燕、楚、齐、赵、宋、卫、中山之众。于是六国之士，\" \\<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \"有宁越、徐尚、苏秦、杜赫之属为之谋；齐明、周最、陈轸、召滑、楼缓、翟景、苏厉、乐毅之徒通其意；吴起、孙膑、带佗、倪良、王廖、田忌、廉颇、赵奢之伦制其兵。\" \\<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \"尝以十倍之地，百万之师，叩关而攻秦。秦人开关延敌，九国之师，逡巡而不敢进。秦无亡矢遗镞之费，而天下诸侯已困矣。于是从散约败，争割地而赂秦。\" \\<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \"秦有余力而制其弊，追亡逐北，伏尸百万，流血漂橹；因利乘便，宰割天下，分裂山河。强国请服，弱国入朝。延及孝文王、庄襄王，享国之日浅，国家无事。及至始皇，\" \\<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \"奋六世之余烈，振长策而御宇内，吞二周而亡诸侯，履至尊而制六合，执敲扑而鞭笞天下，威振四海。南取百越之地，以为桂林、象郡，百越之君，俛首系颈，委命下吏。\" \\<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \"乃使蒙恬北筑长城而守藩篱，却匈奴七百余里；胡人不敢南下而牧马，士不敢弯弓而报怨。于是废先王之道，焚百家之言，以愚黔首；隳名城，杀豪杰；收天下之兵，聚之咸阳，\" \\<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \"销锋镝，铸以为金人十二，以弱天下之民。然后践华为城，因河为池，据亿丈之城，临不测之渊以为固。良将劲弩守要害之处，信臣精卒陈利兵而谁何。天下已定，始皇之心，\" \\<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \"自以为关中之固，金城千里，子孙帝王万世之业也。秦王既没，余威震于殊俗。陈涉，瓮牖绳枢之子，甿隶之人，而迁徒也，才能不及中人，非有仲尼，墨翟贤，陶朱、猗顿之富；\" \\<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \"蹑足行伍之间，而倔起阡陌之中，率疲弊之卒，将数百之众，转而攻秦；斩木为兵，揭竿为旗，天下云集响应，赢粮而景从。山东豪俊遂并起而亡秦族矣。且夫天下非小弱也，雍州之地，\" \\<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \"殽函之固，自若也。陈涉之位，非尊于齐、楚、燕、赵、韩、魏、宋、卫、中山之君也；鉏耰棘矜，非銛于钩戟长铩也；谪戍之众，非抗于九国之师也；深谋远虑，行军用兵之道，非及向时之士也。\" \\<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \"然而成败异变，功业相反也。试使山东之国与陈涉度长絜大，比权量力，则不可同年而语矣。然秦以区区之地，致万乘之势，序八州而朝同列，百有余年矣；然后以六合之家，殽函为官；\" \\<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \"一夫作难而七庙隳，身死人手，为天下笑者，何也？仁义不施而攻守之势异也。\"<br>\nfontFileD = sys.path[0] + \"\\\\新宋体.ttc\"<br>\nfontFileT = sys.path[0] + \"\\\\司马彦行书.ttf\"<br>\nwidth = 600<br>\n<br>\n# 参数计算<br>\nrow = len(trueStr) // 17 + 1<br>\nheight = 20 + row * 32<br>\n<br>\n# 创建对象<br>\nimg = Image.new('RGB', (width, height), (255, 255, 255))<br>\nfontD = ImageFont.truetype(fontFileD, 32)<br>\nfontT = ImageFont.truetype(fontFileT, 32)<br>\ndraw = ImageDraw.Draw(img)<br>\n<br>\n# 绘制干扰文本<br>\nfor i in range(row + 1):<br>\n&nbsp; &nbsp; draw.text((3, 3 + i * 32), subStr(disturbStr), (37, 55, 186), fontD)<br>\n<br>\n# 绘制真实文本<br>\nindex = 0<br>\nrowNow = 0<br>\nwhile index &lt; len(trueStr):<br>\n&nbsp; &nbsp; if index + 17 &lt;= len(trueStr):<br>\n&nbsp; &nbsp; &nbsp; &nbsp; draw.text((10, 10 + 32 * rowNow), trueStr[index:index + 17], (0, 0, 0), fontT)<br>\n&nbsp; &nbsp; else:<br>\n&nbsp; &nbsp; &nbsp; &nbsp; draw.text((10, 10 + 32 * rowNow), trueStr[index:], (0, 0, 0), fontT)<br>\n&nbsp; &nbsp; index = index + 17<br>\n&nbsp; &nbsp; rowNow = rowNow + 1<br>\n<br>\n# 显示图片<br>\n# img.show()<br>\n<br>\n# 保存图片<br>\nimg.save(\"result.jpg\", \"jpeg\")","date":"2020-09-04","agreeCount":1,"discussionCount":0}